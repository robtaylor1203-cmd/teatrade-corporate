<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6152394247686137"
     crossorigin="anonymous"></script>
<script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="c372e1d7-3c7e-4d0a-9cee-23e8ef283836" type="text/javascript" async></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NEW-CORPORATE-ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NEW-CORPORATE-ID');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tea Industry Jobs - TeaTrade Corporate</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="jobs-page">
    <header class="site-header">
        <div class="header-top-bar">
            <a href="index.html" class="header-logo"><h1>Tea<span>Trade</span></h1></a>
            <div class="header-search-wrapper"><input type="text" class="header-search-bar" placeholder="Job title or keyword"></div>
            <div class="user-actions">
                </div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
        </div>
        <nav class="secondary-nav">
            <ul>
                <li><a href="news.html">News</a></li>
                <li><a href="jobs.html" class="active">Jobs</a></li>
                <li><a href="#" class="modal-link-soon">Data</a></li>
                <li><a href="#" class="modal-link-soon">Market Reports</a></li>
                <li><a href="#" class="modal-link-soon">Auctions</a></li>
                <li><a href="#" class="modal-link-soon">Visuals</a></li>
            </ul>
        </nav>
    </header>
    <div class="filter-bar">
        <div class="filter-group">
            <label class="filter-label" for="filter-type">Type</label>
            <select class="filter-dropdown" id="filter-type">
                <option value="all">All Types</option>
            </select>
        </div>
        <div class="filter-group">
            <label class="filter-label" for="filter-location">Location</label>
            <select class="filter-dropdown" id="filter-location">
                <option value="all">All Locations</option>
            </select>
        </div>
    </div>
    <main class="jobs-container">
        <div class="job-list-pane" id="job-list-container"><p style="padding: 16px;">Loading jobs...</p></div>
        <div class="job-details-pane" id="job-details-container"><div class="job-details-content"><p>Select a job to see details.</p></div></div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const jobListContainer = document.getElementById('job-list-container');
            const jobDetailsContainer = document.getElementById('job-details-container');
            const typeFilter = document.getElementById('filter-type');
            const locationFilter = document.getElementById('filter-location');
            
            let jobsData = []; 

            const renderJobDetails = (job) => {
                let responsibilitiesHtml = job.description.responsibilities.map(item => `<li>${item}</li>`).join('');
                let qualificationsHtml = job.description.qualifications.map(item => `<li>${item}</li>`).join('');
                
                const backButtonHtml = window.innerWidth <= 900 ? `<button id="back-to-jobs" style="margin-bottom: 16px; background: none; border: none; color: #1a73e8; font-size: 16px; cursor: pointer; padding: 0;">&larr; Back to List</button>` : '';

                jobDetailsContainer.innerHTML = `<div class="job-details-content">${backButtonHtml}<h2 class="job-title-full">${job.title}</h2><p class="company-name-full">${job.company} &middot; ${job.location}</p><a href="${job.link}" target="_blank" rel="noopener noreferrer"><button class="apply-button">View Opportunity</button></a><hr class="divider"><p>${job.description.intro}</p><h4>Responsibilities:</h4><ul>${responsibilitiesHtml}</ul><h4>Qualifications:</h4><ul>${qualificationsHtml}</ul></div>`;
                
                if (window.innerWidth <= 900) {
                    jobListContainer.style.display = 'none';
                    jobDetailsContainer.style.display = 'block';
                    window.scrollTo(0, 0); 

                    document.getElementById('back-to-jobs')?.addEventListener('click', () => {
                        jobListContainer.style.display = 'block';
                        jobDetailsContainer.style.display = 'none';
                        document.querySelectorAll('.job-card.active').forEach(card => card.classList.remove('active'));
                    });
                }
            };
            
            const renderJobList = (jobsToRender) => {
                jobListContainer.innerHTML = '';
                if (!jobsToRender || jobsToRender.length === 0) {
                     jobListContainer.innerHTML = '<p style="padding: 16px;">No jobs match your filters.</p>';
                     jobDetailsContainer.innerHTML = '<div class="job-details-content"><p>No jobs match your filters.</p></div>';
                     return;
                }
                
                jobsToRender.forEach((job) => {
                    const jobCard = document.createElement('div');
                    jobCard.className = 'job-card';
                    jobCard.dataset.job = job.id;
                    
                    const safeId = btoa(job.id); 

                    jobCard.innerHTML = `
                        <button class="save-btn" title="Save job" 
                                data-item-id="${safeId}" 
                                data-item-type="jobs"
                                data-name="${job.title}"
                                data-company="${job.company}" 
                                data-location="${job.location}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                        </button>
                        <div class="job-card-header">
                            <h3 class="job-title">${job.title}</h3>
                            <p class="company-name">${job.company}</p>
                            <p class="location">${job.location} (${job.type})</p>
                        </div>
                        <p class="job-snippet">${job.snippet}</p>
                    `;
                    
                    jobCard.addEventListener('click', (e) => {
                        if (e.target.closest('.save-btn')) { return; }
                        document.querySelectorAll('.job-card.active').forEach(card => card.classList.remove('active'));
                        jobCard.classList.add('active');
                        renderJobDetails(job);
                    });
                    jobListContainer.appendChild(jobCard);
                });
            };

            const populateJobFilters = (jobs) => {
                const types = new Set();
                const locations = new Set();
                jobs.forEach(job => {
                    if(job.type) types.add(job.type);
                    if(job.location) locations.add(job.location);
                });
                
                [...types].sort().forEach(type => {
                    const option = document.createElement('option');
                    option.value = type.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = type;
                    typeFilter.appendChild(option);
                });
                [...locations].sort().forEach(location => {
                    const option = document.createElement('option');
                    option.value = location.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = location;
                    locationFilter.appendChild(option);
                });
            };

            const applyJobFilters = () => {
                const selectedType = typeFilter.value;
                const selectedLocation = locationFilter.value;

                const filteredJobs = jobsData.filter(job => {
                    const typeMatch = selectedType === 'all' || job.type.toLowerCase().replace(/\s+/g, '-') === selectedType;
                    const locationMatch = selectedLocation === 'all' || job.location.toLowerCase().replace(/\s+/g, '-') === selectedLocation;
                    return typeMatch && locationMatch;
                });
                
                renderJobList(filteredJobs);
                
                if (typeof auth !== 'undefined' && auth.currentUser) {
                    loadAndUpdateSaveStatus(auth.currentUser, 'jobs');
                }
                
                if (window.innerWidth > 900) {
                     if (jobListContainer.firstChild && jobListContainer.firstChild.classList.contains('job-card')) {
                        jobListContainer.firstChild.classList.add('active');
                        const firstJobId = jobListContainer.firstChild.dataset.job;
                        const firstJob = filteredJobs.find(j => j.id === firstJobId);
                        if (firstJob) {
                            renderJobDetails(firstJob);
                        }
                     } else {
                        jobDetailsContainer.innerHTML = '<div class="job-details-content"><p>Select a job to see details.</p></div>';
                     }
                }
            };
            
            const setupResponsiveView = () => {
                if (window.innerWidth <= 900) {
                    if (!document.querySelector('.job-card.active')) {
                         jobDetailsContainer.style.display = 'none';
                         jobListContainer.style.display = 'block';
                    }
                } else {
                    jobDetailsContainer.style.display = 'block';
                    jobListContainer.style.display = 'block';
                }
            };

            window.addEventListener('resize', setupResponsiveView);
            
            fetch('jobs.json')
                .then(response => response.json())
                .then(data => {
                    jobsData = data;
                    
                    if (jobsData && jobsData.length > 0) {
                        populateJobFilters(jobsData);
                        renderJobList(jobsData);
                        
                        if (window.innerWidth > 900) {
                             if (jobListContainer.firstChild) {
                                jobListContainer.firstChild.classList.add('active');
                             }
                            renderJobDetails(jobsData[0]);
                        }
                    } else {
                         jobListContainer.innerHTML = '<p style="padding: 16px;">No jobs found.</p>';
                    }
                    
                    setupResponsiveView();

                    if (typeof auth !== 'undefined' && auth.currentUser) {
                        loadAndUpdateSaveStatus(auth.currentUser, 'jobs');
                    }

                    typeFilter.addEventListener('change', applyJobFilters);
                    locationFilter.addEventListener('change', applyJobFilters);
                })
                .catch(error => { 
                    console.error('Error fetching jobs data:', error); 
                    jobListContainer.innerHTML = '<p style="padding: 16px;">Error loading jobs.</p>'; 
                });
        });
    </script>
    
    <footer class="site-footer-minimal">
        <a href="javascript:void(0);" id="about-link">About Us</a>
        <a href="javascript:void(0);" id="contact-link">Contact</a>
        <a href="https://teatrade.co.uk/privacy.html" target="_blank" rel="noopener noreferrer">Privacy & Disclosure</a>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCEOGY7MXF2H_R6GaeQQubnVE5rlsxiXsg",
        authDomain: "teatrade-c6c67.firebaseapp.com",
        projectId: "teatrade-c6c67",
        storageBucket: "teatrade-c6c67.firebasestorage.app",
        messagingSenderId: "965043250471",
        appId: "1:965043250471:web:49877995f3ec0c9a437502",
        measurementId: "G-9XRWGY128T"
      };
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
    </script>
    <script src="script.js" defer></script>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" id="modal-close-btn" aria-label="Close modal">&times;</button>
            <div id="modal-body-content"></div>
        </div>
    </div>
</body>
</html>